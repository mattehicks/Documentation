{\rtf1\ansi\deflang1033{\fonttbl{\f5\fcharset0 Arabic Typesetting;}{\f6\fcharset0 Arial;}{\f129\fcharset2 Symbol;}{\f131\fcharset0 Times New Roman;}{\f192\fcharset0 Courier;}{\f193\fcharset0 ArialMT;}{\f195\fcharset0 Monaco;}}{\colortbl;\red38\green38\blue38;\red67\green66\blue71;\red83\green83\blue83;\red33\green34\blue36;\red140\green140\blue149;\red0\green0\blue0;}{\stylesheet{\snext0\f6\fs20\fi0\li0\ri0\ql{\*\stloverrides\f6\fs20} Normal;}{\*\cs1\additive Default Paragraph Font;}{\*\cs2\additive\sbasedon1\super Footnote Reference;}{\*\cs3\additive\sbasedon1\super Endnote Reference;}}{\*\listtable{\list{\listlevel\levelstartat1\levelnfc23\leveljc0{\leveltext \'01\u8226 ?;}{\levelnumbers ;}\levelfollow0\fi-360\li720}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}{\listlevel\levelstartat1\levelnfc0\leveljc0{\leveltext \'00;}{\levelnumbers ;}\levelfollow0}\listid65536}{\list\listsimple{\listlevel\levelstartat1\levelnfc23\leveljc0{\leveltext \'01\u61623 ?;}{\levelnumbers ;}\levelfollow0\f129\fi-360\li720}\listid65537}}{\*\listoverridetable{\listoverride\listid65536\listoverridecount0\ls1}{\listoverride\listid65537\listoverridecount0\ls2}}{\*\generator Atlantis Word Processor 2.0.1.0;}{\info{\operator mhicks}{\creatim\yr2016\mo3\dy25\hr13\min0\sec52}{\revtim\yr2017\mo3\dy12\hr15\min26\sec0}}\htmautsp\useltbaln\alntblind\ftnbj\ftnnar\aenddoc\aftnnrlc\paperw12240\paperh15840\margl1440\margr1440\margt720\margb187\pgndec\pgncont\sftnbj\sftnstart1\sftnrstcont\sftnnar\saftnstart1\saftnrstcont\saftnnrlc\sectfullsaved\fet0\pard\plain\f131\fs24\f195\cf1\TLS certs and ACL configuration and troubleshooting on a Cloudera cluster.\\\b Todo: \{\listtext\pard\plain\f131\fs24\f195\cf1\u8226?\tab}\fi-720\li720\tx220\tx720\ls1\b0 change permissions for specific directories\{\listtext\pard\plain\f131\fs24\f195\cf1\u8226?\tab}\kerning1 change ACL list\\pard\tx720\kerning0\\b Creating trustkey and stores\\b0{{\field{\*\fldinst{\f195  HYPERLINK "http://www.cloudera.com/documentation/enterprise/latest/topics/cm_sg_create_key_trust.html" }}{\fldrslt{\f195 http://www.cloudera.com/documentation/enterprise/latest/topics/cm_sg_create_key_trust.html}}}}\\\\b SSL handshake error troubleshotting:\\b0{{\field{\*\fldinst{\f195  HYPERLINK "https://community.cloudera.com/t5/Cloudera-Manager-Installation/SSL-handshake-error-when-configuring-SSL-for-Cloudera-Navigator/td-p/26551/page/2" }}{\fldrslt{\f195 https://community.cloudera.com/t5/Cloudera-Manager-Installation/SSL-handshake-error-when-configuring-SSL-for-Cloudera-Navigator/td-p/26551/page/2}}}}\\pard\f6\cf0\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}\fi-360\li720\jclisttab\tx720\ls2\f5\fs32\cf6 Navigator TLS \{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}\kerning1 f\kerning0 reeIPA as certificate authority \{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}{{\field{\*\fldinst{\f5  HYPERLINK "https://community.cloudera.com/t5/Cloudera-Manager-Installation/SSL-handshake-error-when-configuring-SSL-for-Cloudera-Navigator/td-p/26551" }}{\fldrslt{\f5 https://community.cloudera.com/t5/Cloudera-Manager-Installation/SSL-handshake-error-when-configuring-SSL-for-Cloudera-Navigator/td-p/26551}}}}\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}On the Namenode (same host the Cloudera Manager lives on), I generated a certificate and key to be used by Cloudera Manager\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}# kinit -kt /etc/krb5.keytab\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}# ipa-getcert request -f cmhost.pem -k cmhost.key -r\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}# chmod 600 cmhost*\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}Then I copied the newly created cm-keys directory to each host.\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}$ for x in \{LIST_OF_CDH_HOSTS\}; do scp -r cm-keys $x:; done\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\fs32\cf6\u-3913?\f5\tab}$ for x in \{LIST_OF_CDH_HOSTS\}; do ssh -tty $x sudo bash -c "'mkdir -p /opt/cloudera/security/x509; mv cm-keys/* /opt/cloudera/security/x509; chown cloudera /opt/cloudera/security/x509/*'"; done\{\listtext\pard\plain\f131\fs24\jclisttab\tx720\f129\u-3913?\f5\tab}Next, I set up Puppet to configure Cloudera to use TLS.\fs24\cf0\\pard\fi-187\li547\tx720\f6\cf1\\pard\cf4\\li720\ri806\f5\fs30 …The document is actually just to outline the permissions.{\fs24\i\cf0{\field{\*\fldinst{\f5  HYPERLINK "https://datarobot.slack.com/archives/nvent-hadoop/p1455151005000094" }}{\fldrslt{\f5\i\fs24\cf0\}}}}\cf0\i\fs24\fs30\i0\cf4 The plan is to instate Sentry and use it to determine our access plan.\fs26\cf5 (edited){\fs24\i\cf0{\field{\*\fldinst{\f5  HYPERLINK "https://datarobot.slack.com/archives/nvent-hadoop/p1455151071000096" }}{\fldrslt{\f5\i\fs24\cf0\}}}}\cf0\i\fs24\fs30\i0\cf4 I am going to use the sample databases that we've discussed{\fs24\i\cf0{\field{\*\fldinst{\f5  HYPERLINK "https://datarobot.slack.com/archives/nvent-hadoop/p1455151098000097" }}{\fldrslt{\f5\i\fs24\cf0\}}}}\cf0\i\fs24\fs30\i0\cf4 And work with the sentry database - to determine the best available option for user access strategies{\fs24\i\cf0{\field{\*\fldinst{\f5  HYPERLINK "https://datarobot.slack.com/archives/nvent-hadoop/p1455151179000098" }}{\fldrslt{\f5\i\fs24\cf0\}}}}\cf0\i\fs24\fs30\i0\cf4 Then if we can put together a working prototype - then we construct user groupings and actual database endpoints, and move them into place for testing.\fs26\cf5 (edited)\\f195\fs24\cf1\\pard\tx720\\b\ul From online forums (troubleshooting nav TLS):\\b0\ulnone\\pard\f6\cf3 Ok so you have 2 paradigims that you are configuring for, the JDK, and OpenSSL\\~\"Trust" is established differently between the two implementations, Navigator, being Java based, will derive trust through the default JDK mechanisims I pointed out\\~\For the Agents, Hue, and Implala the implementation is based on OpenSSL. Trust can be established for a root CA by directly configuring path to a CA pem file, or if there is a complex intermediary chain through providing the path to where the files are and running the c_rehash tool to generate the necessary base64 encoded symlinks.\\~\Navigator is expecting you to configure a jks with private key and installed cert, but then as navigator attempts to connect to other cluster services that are using SSL/TLS, it needs to trust the CA that issued the server cert...\\cf1\\cf3 So you need to consider that you have a private key component, and a issued certificate component... the combination of the two in a JKS (private key and certificate) allow you to start up a java based service that will support SSL/TLS connections.\cf1\\\cf3 You can use your IPA based appoach as long as you have access to the private key and certificate it issues, to combine them and then import into a JKS.\\~\The the CA certificate that issued the certificate, imported into the truststores I've discussed already, establishes inherent trust within java services, for SSL certificates created by that CA.\fs32\f193\\sl400\slmult0\\pard\f195\fs24\cf1 ……………………\Notes:\\\8088: HUE\8089: Nav Status\7180: CM\7187: Navigator\\curl -vvvv https://cdh-master1.rd1.hq.YourCompanyDomain.com:7187 \\$ curl -vvvv {{\field{\*\fldinst{\f195  HYPERLINK "https://cdh-master1.rd1.hq.datarobot.com:7183/api/v1/users/sean" }}{\fldrslt{\f195 https://cdh-master1.rd1.hq.YourCompanyDomain.com:7183/api/v1/users/}}}}nventmatt\ \~ \~(fails due to cert error)\\$ wget {{\field{\*\fldinst{\f195  HYPERLINK "https://certs.godaddy.com/repository/gd_bundle-g2-g1.crt" }}{\fldrslt{\f195 https://certs.godaddy.com/repository/gd_bundle-g2-g1.crt}}}}\$ curl -vvvv --cacert gd_bundle-g2-g1.crt {{\field{\*\fldinst{\f195  HYPERLINK "https://cdh-master1.rd1.hq.YourCompanyDomain.com:7183/api/v1/users/sean" }}{\fldrslt{\f195 https://cdh-master1.rd1.hq.YourCompanyDomain.com:7183/api/v1/users/sean}}}}\ \~ \~(no longer an ssl error)\\\hdfs dfs -setfacl -m -R  user:nifi:rwx /data/final/\\\Analyzing with HUE and HIVE:\{{\field{\*\fldinst{\f195  HYPERLINK "https://blog.cloudera.com/blog/2013/04/demo-analyzing-data-with-hue-and-hive/" }}{\fldrslt{\f195 https://blog.cloudera.com/blog/2013/04/demo-analyzing-data-with-hue-and-hive/}}}}\\troubleshoot TLS certs\{{\field{\*\fldinst{\f195  HYPERLINK "http://searchdatacenter.techtarget.com/tip/Troubleshooting-TLS-certificates-on-Linux-servers" }}{\fldrslt{\f195 http://searchdatacenter.techtarget.com/tip/Troubleshooting-TLS-certificates-on-Linux-servers}}}}\{{\field{\*\fldinst{\f195  HYPERLINK "http://www.cloudera.com/documentation/enterprise/5-2-x/topics/cm_sg_tls_troubleshoot.html" }}{\fldrslt{\f195 http://www.cloudera.com/documentation/enterprise/5-2-x/topics/cm_sg_tls_troubleshoot.html}}}}\\\"HELLO WORLD SQL QUERY"\\f192\fs26\cf2 $ spark-shell\> val users = sqlContext.read.json("/data/raw/mmapp/users/20160205")\> users.registerTempTable("users")\> sqlContext.sql("SELECT * FROM users LIMIT 10").show()\\f195\fs24\cf1\\\\\\\\\}